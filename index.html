<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>jQuery game</title>
    <style>
        .cell {
            border: 1px solid black;
            width: 16px;
            height: 16px
        }

        .party {
            background: blue;
            color: white;
            text-align: center;
        }

        .snake {
            background: yellow;
        }

        .head {
            background: red;
            background-image: url('https://cdn4.iconfinder.com/data/icons/penguin/154/penguin-baby-small-animal-512.png');
            background-size: 16px 16px;
        }

        .pink {
            background: pink;
        }


    </style>
</head>
<body>

<div id="board"></div>
<script src="js/jquery-3.2.1.js"></script>
<script>

        var $board = $('#board');
        var $table = $('<table>');
        var $tr = $('<tr>');
        var $td;

        function createTable(width, height) {
            for (var j = 0; j < height; j++) {
                $tr = $('<tr>');
                for (var i = 0; i < width; i++) {
                    $td = $('<td>');
                    $tr.append($td);
                }
                $table.append($tr);
            }
        }

        createTable(20, 20);
        $('td', $table).addClass('cell');
        $board.append($table);

        var snakeCells = $('td').slice(0, 2).toArray(); //snake length
        $(snakeCells).addClass('snake');
        $(snakeCells[snakeCells.length-1]).addClass('head');

        function drawParty(x, y, n) {
            for (var i = x; i < x + 3; i++) {
                for (var j = y; j < y + 3; j++) {
                    $('table tr:nth-child(' + i + ') td:nth-child(' + j + ')').addClass('party party' + n);
                }
            }
            return $('.party' + n);
        }

        $partyOne = drawParty(5, 5, 1); // drawing party places
        $partyTwo = drawParty(5, 14, 2);
        $partyThree = drawParty(14, 1, 3);
        $partyFour = drawParty(14, 14, 4);

        var partyOneFriends = Math.round(Math.random(0,1)*2 + 2); // generating Friends in party places
        var partyTwoFriends = Math.round(Math.random(0,1)*3 + 2);
        var partyThreeFriends = Math.round(Math.random(0,1)*2+ 2);
        var partyFourFriends = Math.round(Math.random(0,1)*4 +2);

        $('.party1').slice(0,1).text(partyOneFriends); // generating number of Friends in party places
        $('.party2').slice(0,1).text(partyTwoFriends);
        $('.party3').slice(0,1).text(partyThreeFriends);
        $('.party4').slice(0,1).text(partyFourFriends);

        var moves = {
            38: function up($node) {
                return $node.parent().prev().find('.cell').eq($node.index());
            },
            40: function down($node) {
                return $node.parent().next().find('.cell').eq($node.index());
            },
            37: function left($node) {
                return $node.prev();
            },
            39: function right($node) {
                return $node.next();
            }
        };

        moves[38].invalid = 40;
        moves[40].invalid = 38;
        moves[37].invalid = 39;
        moves[39].invalid = 37;

        var direction = moves[40];

        function checkInParty(n){  //anyParty
            return !!$( '.snake.party' + n).length && !$('.snake.head.party' + n).length;
        }

        var interval = setInterval(function () {

            var tail = snakeCells[0];
            var head = snakeCells[snakeCells.length - 1];

            $(head).removeClass('head');

            var $nextHead = direction($(head));

            $(tail).removeClass('snake');
            snakeCells = snakeCells.slice(1);

            snakeCells = snakeCells.concat($nextHead.get(0));
            $nextHead.addClass('head snake');

            if( checkInParty(1) || checkInParty(2) || checkInParty(3) || checkInParty(4)){  //anyParty
//                clearInterval(interval);
                if (partyThreeFriends > 0) {
                    partyThreeFriends -= 1;
                    return $('.party3').slice(0,1).text(partyThreeFriends);  //Three party
                }
            }


        }, 500)


</script>
</body>
</html>