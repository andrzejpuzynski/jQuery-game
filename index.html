<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>jQuery game</title>
    <style>
        .cell {
            border: 1px solid black;
            width: 16px;
            height: 16px
        }

        .party {
            background: blue;
            color: white;
            text-align: center;
        }

        .snake {
            background: yellow;
        }

        .friends {
            background: lightblue;
        }

        .aliens {
            background: black;
        }

        .head {
            background: red;
            background-image: url('https://cdn4.iconfinder.com/data/icons/penguin/154/penguin-baby-small-animal-512.png');
            background-size: 16px 16px;
        }

        .pink {
            background: pink;
        }


    </style>
</head>
<body>

<div id="board"></div>
<script src="js/jquery-3.2.1.js"></script>
<script>

        var $board = $('#board');
        var $table = $('<table>');
        var $tr = $('<tr>');
        var $td;

        function createTable(width, height) {
            for (var j = 0; j < height; j++) {
                $tr = $('<tr>');
                for (var i = 0; i < width; i++) {
                    $td = $('<td>');
                    $tr.append($td);
                }
                $table.append($tr);
            }
        }

        createTable(20, 20); // drawing board ---------
        $('td', $table).addClass('cell');
        $board.append($table);

        var aliens = 1; // snake chcaracter ---------
        var friends = 1;
        var snakeLength =  1 + friends + aliens;

        var snakeCells = $('td').slice(0, snakeLength).toArray(); //snake length
        $(snakeCells).addClass('snake');
        $(snakeCells[snakeCells.length-1]).addClass('head');

        function drawSnake() {
            for (var i = 0; i < aliens; i++) {
                $(snakeCells[i]).addClass('aliens');
            }
            for (var j = aliens; j < aliens + friends; j++) {
                $(snakeCells[j]).addClass('friends');
            }
        }

        drawSnake(); // drawing snake ---------

        function drawParty(x, y, n) {
            for (var i = x; i < x + 3; i++) {
                for (var j = y; j < y + 3; j++) {
                    $('table tr:nth-child(' + i + ') td:nth-child(' + j + ')').addClass('party party' + n);
                }
            }
            return $('.party' + n);
        }

        $partyOne = drawParty(5, 5, 1); // drawing party places  ---------
        $partyTwo = drawParty(5, 14, 2);
        $partyThree = drawParty(14, 5, 3);
        $partyFour = drawParty(14, 14, 4);

        var partyFriends1 = Math.round(Math.random(0,1)*2 + 1); // generating Friends in party places
        var partyFriends2 = Math.round(Math.random(0,1)*3 + 1);
        var partyFriends3 = Math.round(Math.random(0,1)*2+ 1);
        var partyFriends4 = Math.round(Math.random(0,1)*4 +1);

        $('.party1').slice(0,1).text(partyFriends1); // generating number of Friends in party places
        $('.party2').slice(0,1).text(partyFriends2);
        $('.party3').slice(0,1).text(partyFriends3);
        $('.party4').slice(0,1).text(partyFriends4);

        var moves = {
            38: function up($node) {
                return $node.parent().prev().find('.cell').eq($node.index());
            },
            40: function down($node) {
                return $node.parent().next().find('.cell').eq($node.index());
            },
            37: function left($node) {
                return $node.prev();
            },
            39: function right($node) {
                return $node.next();
            }
        };

        moves[38].invalid = 40;
        moves[40].invalid = 38;
        moves[37].invalid = 39;
        moves[39].invalid = 37;

        var direction = moves[40];


        $(window).on('keydown', function (event) {  // change direction

            var code = event.keyCode

            if (code === direction.invalid) {
                return
            }

            direction = moves[event.keyCode] || direction
        });


        function exitParty(n){  //anyParty
            return !!$( '.snake.party' + n).length && !$('.snake.head.party' + n).length;
        }

        var interval = setInterval(function () {

            var tail = snakeCells[0];
            var head = snakeCells[snakeCells.length - 1];
            var $nextHead = direction($(head));

            if(exitParty(1) &&partyFriends1 > 0) {
                partyFriends1 -= 1;
                $('.party1').slice(0, 1).text(partyFriends1);
                $(snakeCells).removeClass('head friends aliens');
                friends +=1;

            } else if (exitParty(2) &&partyFriends2 > 0) {
                partyFriends2 -= 1;
                $('.party2').slice(0, 1).text(partyFriends2);
                $(snakeCells).removeClass('head friends aliens');
                friends +=1;

            } else if (exitParty(3) &&partyFriends3 > 0) {
                partyFriends3 -= 1;
                $('.party3').slice(0, 1).text(partyFriends3);
                $(snakeCells).removeClass('head friends aliens');
                friends +=1;

            } else if (exitParty(4) &&partyFriends4 > 0) {
                partyFriends4 -= 1;
                $('.party4').slice(0, 1).text(partyFriends4);
                $(snakeCells).removeClass('head friends aliens');
                friends += 1;
            } else {
                $(snakeCells).removeClass('head friends aliens');
                $(tail).removeClass('snake');
                snakeCells = snakeCells.slice(1);
            }


//            $(snakeCells).removeClass('head friends aliens');
//            $(tail).removeClass('snake');
//            snakeCells = snakeCells.slice(1);
            snakeCells = snakeCells.concat($nextHead.get(0));
            $nextHead.addClass('head snake');
            drawSnake();



//                clearInterval(interval);
        }, 400)


</script>
</body>
</html>